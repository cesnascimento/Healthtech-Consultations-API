# ==============================================
# Healthtech Consultations API - Docker Compose
# ==============================================
#
# Uso:
#   docker-compose up -d          # Inicia em background
#   docker-compose up             # Inicia com logs
#   docker-compose down           # Para containers
#   docker-compose logs -f api    # Acompanha logs
#   docker-compose build          # Rebuild da imagem
#
# Configuração via .env (lido automaticamente)
#
# ==============================================

services:
  # ----------------------------------------------
  # API Principal
  # ----------------------------------------------
  api:
    build:
      context: .
      dockerfile: Dockerfile
    image: healthtech-consultations:latest
    container_name: healthtech-api
    restart: unless-stopped
    ports:
      - "${PORT:-4000}:${PORT:-4000}"
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:${PORT:-4000}/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - healthtech-network
    deploy:
      resources:
        limits:
          cpus: "2.0"
          memory: 1G
        reservations:
          cpus: "0.5"
          memory: 256M

  # ----------------------------------------------
  # Desenvolvimento com hot reload
  # ----------------------------------------------
  api-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: healthtech-consultations:dev
    container_name: healthtech-api-dev
    profiles:
      - dev
    ports:
      - "${PORT:-4000}:${PORT:-4000}"
    env_file:
      - .env
    volumes:
      - ./app:/app/app:ro
    networks:
      - healthtech-network

networks:
  healthtech-network:
    driver: bridge
    name: healthtech-network
